<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
    <legend>添加栏目</legend>
</fieldset>
<div class="site-text site-block">
    <form id="addCategoryForm" class="layui-form">
        <div class="layui-form-item">
            <label class="layui-form-label">栏目名称</label>
            <div class="layui-input-inline">
                <input type="text" name="categoryTitle" id="categoryTitle" required="" lay-verify="required"
                       placeholder="请输入栏目名称" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">自定义顺序</label>
            <div class="layui-input-inline">
                <input type="text" name="categoryOrder" required="" lay-verify="required|number"
                       placeholder="自定义顺序" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">辅助文字</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">属性</label>
            <div class="layui-input-block">
                <input type="radio" name="categoryType" value="index" title="主页栏目">
                <input type="radio" name="categoryType" value="normal" title="普通栏目" checked="checked">
            </div>
        </div>
        <!--TODO: skin choose-->
        <div class="layui-form-item">
            <label class="layui-form-label">选择皮肤</label>
            <div class="layui-input-block">
                <!--<input type="radio" name="sex" value="女" title="女" checked>-->
                <!--单选框name 为控件名，value是提交到服务器的值-->
                <input type="radio" name="categorySkin" value="default" title="默认" checked="checked">
            </div>
        </div>
        <div id="show" class="layui-form-item">
            <label class="layui-form-label">所属栏目</label>
            <div class="layui-input-inline">
                <input id="category_id" class="layui-hide" name="categoryParentId" required
                       lay-verify="required|number">
                <input type="text" id="belongCategory" required="required" lay-verify="required"
                       placeholder="选择栏目"
                       autocomplete="off"
                       class="layui-input" readonly="readonly"/>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">是否放到首页</label>
            <div class="layui-input-block">
                <input type="radio" name="categoryInHomepage" value="true" title="是">
                <input type="radio" name="categoryInHomepage" value="false" title="否" checked>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">描述</label>
            <div class="layui-input-block">
                <textarea id="categoryDesc" name="categoryDesc" required class="layui-textarea"
                          placeholder="添加描述"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button lay-submit class="layui-btn" lay-filter="createCategory">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>
<script>
    $.fn.serializeObject = function () {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function () {
            if (o[this.name]) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };
    $(function () {
        var form = layui.form;
        form.render();
        form.on('submit(createCategory)', function () {
            layui.layer.alert("enter form on func");
            submitCategory();
            layui.layer.alert("end");
            return false;
        });
        $("#belongCategory").on('click', function () {
            $.get('/module/selectCategory.html', {}, function (str) {
                layer.open({
                    type: 1,
                    skin: 'layui-layer-rim',
                    closeBtn: 1,
                    anim: 5,
                    area: ['300px', '350px'],
                    content: str,
                    success: function (layero, index) {
                        console.log(layero, index);
                    }
                });
            });
        });
    });

    function submitCategory() {
        formData = $("#addCategoryForm").serializeObject();
        alert("form data: " + JSON.stringify(formData));
        $.ajax({
            type: "POST",
            url: '/category/add',
            data: JSON.stringify(formData),
            async: false,
            contentType: 'application/json',
            dataType: 'json',
            error: function (resp) {
                alert("form data: " + JSON.stringify(formData));
                layui.layer.alert("failed. " + resp);
            },
            success: function (resp) {
                layui.layer.alert("添加成功; " + resp);
                showAtRight("/module/listCategory.html");
            }
        });
    }
</script>