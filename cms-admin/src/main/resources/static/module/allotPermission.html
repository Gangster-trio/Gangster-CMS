<script src="/util/jquery-editable-select.js"></script>
<link rel="stylesheet" href="/util/jquery-editable-select.css">
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
    <legend>分配权限</legend>
</fieldset>
<div>
    <form class="layui-form" id="allotPermission">
        <h1 id="groupName">这是角色名</h1>
        <br/>
        <div class="layui-form-item">
            <label class="layui-form-label">站点选择:</label>
            <div class="layui-input-inline">
                <select name="selectSite" id="selectSite" lay-filter="selectSite">
                    <option value="">请选择站点</option>
                </select>
            </div>
            <label class="layui-form-label">模块选择:</label>
            <div class="layui-input-inline">
                <select name="module" id="module" lay-filter="selectModule">
                    <option value="">请选择模块</option>
                </select>
            </div>
            <label class="layui-form-label">栏目选择:</label>
            <div class="layui-input-inline">
                <select name="selectCategory" lay-filter="selectCategory" id="selectCategory" onclick="selectCategory()">
                    <option value="" id="category">请选择栏目</option>
                </select>
            </div>
        </div>

        <div class="layui-form-item" pane="">
            <label class="layui-form-label">权限分配</label>
            <div class="layui-input-block">
                <input type="checkbox" name="permission" value="READ" lay-skin="primary" title="读权限">
                <input type="checkbox" name="permission" value="WRITE" lay-skin="primary" title="写权限">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button lay-submit class="layui-btn"  id="btn" name="btn"   lay-filter="btn">提交信息</button>
            </div>
        </div>
    </form>
</div>
<!--<script type="text/javascript">-->
    <!--var form = layui.form;-->
    <!--form.on('submit(btn)', function () {-->
        <!--var obj = document.getElementsByName('permission');-->
        <!--var permissions = new Array();-->
        <!--for (var i = 0; i < obj.length; i++) {-->
            <!--if (obj[i].checked)-->
                <!--permissions.push(obj[i].value);-->
        <!--}-->
<!--//        var id = getUrlVar("groupId");-->
<!--//        console.log(id);-->
        <!--$.ajax({-->
            <!--url: "/permission/addpermission",-->
            <!--type: 'post',-->
            <!--dataType: 'json',-->
            <!--contentType: "application/json",-->
            <!--data: JSON.stringify({-->
                <!--"permissionName": permissions,-->
                <!--"groupId": groupId,-->
                <!--"siteId": $("#site").val(),-->
                <!--"categoryId": $("#category").val(),-->
                <!--"moudleId": $("#module").val()-->
            <!--}),-->
            <!--success: function (data) {-->
                <!--console.log(data);-->
                <!--if (data === 1) {-->
                    <!--//关闭弹框-->
                    <!--layer.msg("添加成功", {icon: 6});-->
                    <!--window.parent.location.reload();-->
                    <!--var index = parent.layer.getFrameIndex(window.name);-->
                    <!--parent.layer.close(index);-->
                    <!--showAtRight("/module/listGroup.html");-->
                <!--} else {-->
                    <!--layer.msg("添加失败", {icon: 5});-->
                    <!--window.parent.location.reload();-->
                    <!--var index = parent.layer.getFrameIndex(window.name);-->
                    <!--parent.layer.close(index);-->
                    <!--showAtRight("/module/listGroup.html");-->

                <!--}-->
                <!--var index = parent.layer.getFrameIndex(window.name);-->
                <!--parent.layer.close(index);-->
                <!--showAtRight("/module/listGroup.html");-->
            <!--}-->
        <!--})-->
<!--//    }-->
    <!--});-->
<!--</script>-->
<script type="text/javascript">
    $(function () {
        $.ajax({
            url: "/permission/findGroupName/" + groupId,
            type: 'get',
            dataType: 'json',
            success: function (ajaxdata) {
                if (ajaxdata !== null) {
                    $("#groupName").html(ajaxdata.data[0].groupName);
                }
            }
        });
        form.on('select(selectSite)', function () {
            var form = layui.form();
            $.ajax({
                url: "/permission/findsite",
                type: 'get',
                dataType: 'json',
                success: function (ajaxdata) {
                    var optionstring1 = "";
                    for (var i = 0; i < ajaxdata.code; i++) {
                        optionstring1 += "<option value=" + '"' + ajaxdata.data[i].siteId + '"' + ">" + ajaxdata.data[i].siteName + "</option>";
                        console.log(optionstring1);
                    }
                    $("#selectSite").append(optionstring1);
                    $("#category").remove();
                    $("#selectCategory").append("<option value=''>请选择栏目</option>");
                    form.render('select');
                    return false;
                }
            });
        });
                $.ajax({
                    url: "/permission/findmodel",
                    type: 'get',
                    dataType: 'json',
                    success: function (ajaxdata) {
                        var optionstring2 = "";
                        for (var i = 0; i < ajaxdata.code; i++) {
                            optionstring2 += "<option value=" + '"' + ajaxdata.data[i].moduleId + '"' + ">" + ajaxdata.data[i].moduleName + "</option>";
                        }
                        $("#module").append(optionstring2);
                        form.render('select');
                    }
                });


        form.on('select(selectCategory)', function () {
            var form=layui.form();
            var sid = $("#selectSite").val();
          $.ajax({
              url: "/permission/findcategory/" + sid,
              type: 'get',
              dataType: 'json',
              async: false,
              success: function (ajaxdata) {
                  var optionstring3 = "";
                  if (ajaxdata.data !== null) {
                      for (var i = 0; i < ajaxdata.code; i++) {
                          console.log(ajaxdata.data[i]);
                          optionstring3 += "<option value=" + '"' + ajaxdata.data[i].categoryId + '"' + "id='category'"+">" + ajaxdata.data[i].categoryTitle + "</option>";
                      }
                      $("#selectCategory").append(optionstring3);
                      form.render('select');
                  }
              }
          });
//          return false;
        })
    });




</script>
<!--<script>-->
   <!---->
<!--</script>-->
<!--<script type="text/javascript">-->
    <!--var moduletime = 1;-->
    <!--var modulesign = 1;-->

    <!--function selectModule() {-->
        <!--var optionstring = "";-->
        <!--if (modulesign === 1) {-->
            <!--$.ajax({-->
                <!--url: "/permission/findmodel",-->
                <!--type: 'get',-->
                <!--dataType: 'json',-->
                <!--success: function (ajaxdata) {-->
                    <!--for (var i = 0; i < ajaxdata.code; i++) {-->
                        <!--optionstring += "<option value=" + '"' + ajaxdata.data[i].moduleId + '"' + ">" + ajaxdata.data[i].moduleName + "</option>";-->
                    <!--}-->
                    <!--$("#module").append(optionstring);-->
                <!--}-->
            <!--});-->
        <!--}-->
        <!--var time = moduletime + 1;-->
        <!--modulesign = time % 2;-->
    <!--}-->
<!--</script>-->
<!--<script type="text/javascript">-->
    <!--var categorytime = 1;-->
    <!--var categorysign = 1;-->

    <!--function selectCategory() {-->
        <!--var sid = new Sid();-->
        <!--var optionstring = new Optionstring();-->
        <!--if (categorysign === 1) {-->
            <!--sid.id = null;-->
            <!--sid.id = $("#site").val();-->
            <!--$.ajax({-->
                <!--url: "/permission/findcategory/" + sid.id,-->
                <!--type: 'get',-->
                <!--dataType: 'json',-->
                <!--success: function (ajaxdata) {-->
                    <!--if (ajaxdata.data != null) {-->
                        <!--for (var i = 0; i < ajaxdata.code; i++) {-->
                            <!--optionstring.have += "<option value=" + '"' + ajaxdata.data[i].categoryId + '"' + ">" + ajaxdata.data[i].categoryTitle + "</option>";-->
                        <!--}-->
                        <!--$("#category").html(optionstring.have);-->
                        <!--var time = categorytime + 1;-->
                        <!--categorysign = time % 2;-->
                    <!--} else {-->
                        <!--optionstring.have.valueOf("");-->
                        <!--$("#category").html(optionstring.have);-->
                        <!--var time = categorytime + 1;-->
                        <!--categorysign = time % 2;-->
                    <!--}-->
                <!--}-->
            <!--});-->
        <!--}-->

    <!--}-->
<!--</script>-->
<!--<script>-->
    <!--window.onload = function () {-->
<!--//        var id = getUrlVar("groupId");-->
        <!--$.ajax({-->
            <!--url: "/permission/findGroupName/" + groupId,-->
            <!--type: 'get',-->
            <!--dataType: 'json',-->
            <!--success: function (ajaxdata) {-->
                <!--if (ajaxdata != null) {-->
                    <!--$("#groupName").html(ajaxdata.data[0].groupName);-->
                <!--}-->
            <!--}-->
        <!--})-->
    <!--}-->
<!--</script>-->
<!--<script>-->
    <!--function Sid() {-->
    <!--}-->
<!--</script>-->
<!--<script>-->
    <!--function Optionstring() {-->
    <!--}-->
<!--</script>-->