<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta charset="utf-8"/>
    <title></title>
    <link href="/layui/css/layui.css" rel="stylesheet"/>
    <script src="/layui/layui.all.js"></script>
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <script src="/layui/tree.js"></script>
    <script src="/util/util.js"></script>
</head>
<body style="background-color:#eee;">

<br/>
<br/>
<form class="layui-form" action="">
    <div class="layui-form-item">
        <label class="layui-form-label">栏目名称</label>
        <div class="layui-input-inline">
            <input type="text" id="categoryTitle" name="categoryTitle" required="required" lay-verify="required"
                   placeholder="栏目名称"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">自定义顺序</label>
        <div class="layui-input-inline">
            <input type="text" id="order" name="order" required="required" lay-verify="required" placeholder="自定义顺序"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">所属栏目</label>
        <div class="layui-input-inline">
            <input type="text" id="addCategory" name="addCategory" required="required" lay-verify="required"
                   placeholder="顶级栏目管理"
                   autocomplete="off"
                   class="layui-input" readonly="readonly"/>
        </div>
    </div>
    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">栏目描述</label>
        <div class="layui-input-block">
            <textarea id="desc" name="desc" required="required" placeholder="请输入内容" class="layui-textarea"></textarea>
        </div>
    </div>
    <!--隐藏 parentid-->
    <div>
        <input id="parentId" name="parentId" type="text" hidden="hidden"/>
    </div>
    <input type="button" value="提交" id="btn1" class="layui-btn" style="margin-left:5%;margin-top:20px;"/>
</form>
</body>
</html>
<script>
    var initCategoryId;
    window.onload = function () {

        $.ajax({
            type: "get",
            url: "/category/details/" + getUrlVar("id"),
            success: function (data) {
                initCategoryId = data.categoryParentId;
                console.log(data);
                $("#categoryTitle").val(data.categoryTitle);
                $("#order").val(data.categoryOrder);
                $("#desc").val(data.categoryDesc);
                $("#addCategory").val(data.parentName);
            }
        });
    };
    document.getElementById('btn1').onclick = function () {
        var categoryTitle = document.getElementById("categoryTitle").value;
        var parentId = document.getElementById("parentId").value;
        if (parentId.length === 0) parentId = initCategoryId;
        var order = document.getElementById("order").value;
        var desc = document.getElementById("desc").value;
        $.ajax({
            url: "/category/add",
            type: 'post',
            dataType: 'json',
            contentType: "application/json",
            data: JSON.stringify({
                "categoryTitle": categoryTitle,
                "categoryParentId": parentId,
                "categoryDesc": desc,
                "categoryOrder": order
            }),
            success: function (data) {
                console.log(data);
                if (data.code === 0) layer.msg("添加成功", {icon: 6});
                else layer.msg("添加失败", {icon: 5});
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
                showAtRight("/fragement/listCategory.html");
            }
        });
    }
</script>
<script type="text/javascript">
    var index = $("#addCategory").on('click', function () {
        layer.open({
            id: 2,
            type: 2,
            skin: 'layui-layer-rim',
            closeBtn: 1,
            anim: 2,
            content: '/fragement/selectCategory.html',
            success: function (layero, index) {
                console.log(layero, index);
            }
        });
    })
</script>