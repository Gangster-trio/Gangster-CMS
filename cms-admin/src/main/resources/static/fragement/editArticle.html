<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta charset="utf-8"/>
    <title></title>
    <link href="/layui/css/layui.css" rel="stylesheet"/>
    <script src="/layui/layui.js"></script>
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <script src="/layui/layui.js"></script>
    <script src="/util/jquery.form.js"></script>
    <script src="/util/util.js"></script>
</head>
<body style="background-color:#eee;">
<br/>
<div class="layui-form-item">
    <label class="layui-form-label">文章标题</label>
    <div class="layui-input-inline">
        <input type="text" id="articleTitle" name="articleTitle" required lay-verify="required" placeholder="文章名称"
               autocomplete="off"
               class="layui-input">
    </div>
</div>
<div class="layui-form-item">
    <label class="layui-form-label">自定义顺序</label>
    <div class="layui-input-inline">
        <input type="text" id="order" name="order" required lay-verify="required" placeholder="自定义顺序" autocomplete="off"
               class="layui-input">
    </div>
</div>
<form class="layui-form" action="">
    <div class="layui-form-item">
        <label class="layui-form-label">文章属性</label>
        <div class="layui-input-block">
            <!--<input type="radio" name="sex" value="女" title="女" checked>-->
            <!--单选框name 为控件名，value是提交到服务器的值-->
            <input type="radio" name="choose" value="幻灯" title="幻灯">
            <input type="radio" name="choose" value="推荐" title="推荐">
            <input type="radio" name="choose" value="图片" title="图片">
            <input type="radio" name="choose" value="头条" title="头条" checked>
        </div>
    </div>
</form>
<div class="layui-form-item layui-form-text">
    <form id="img" action="/article/img" method="post" enctype="multipart/form-data">
        <img width="100" height="100" id="image"/>
        <!-- 在选择图片的时候添加事件，触发Ajax异步上传 -->
        <input name="file" type="file" onchange="uploadImg()"/>
    </form>
</div>
<div class="layui-form-item">
    <label class="layui-form-label">文章作者</label>
    <div class="layui-input-inline">
        <input type="text" id="author" name="author" required lay-verify="required" placeholder="文章作者"
               autocomplete="off"
               class="layui-input">
    </div>
</div>
<div class="layui-form-item">
    <label class="layui-form-label">所属栏目</label>
    <div class="layui-input-inline">
        <input type="text" id="categoryName" name="categoryName" required lay-verify="required" placeholder="所属栏目"
               autocomplete="off"
               class="layui-input" readonly="readonly">
    </div>
</div>
<div class="layui-form-item layui-form-text">
    <label class="layui-form-label">描述</label>
    <div class="layui-input-block">
        <textarea id="description" name="description" class="layui-textarea" placeholder="添加描述" rows="50"
                  cols="40"></textarea>
    </div>
</div>
文章内容
<div style="width:90%;margin-left:5%;margin-top:100px;background-color:#fff;">
    <textarea name="txt" id="txt" style="display:none;"></textarea>
</div>
<div>
    <!--这里是文章选择栏目id 的隐藏区域-->
    <input id="parentId" name="parentId" type="text" hidden="hidden"/>
</div>
<input type="button" value="提交文章" id="btn1" class="layui-btn" style="margin-left:5%;margin-top:20px;"/>
</body>
</html>
<script type="text/javascript">
    var initCategoryId;   //初始加载的文章表的栏目id
    window.onload = function () {
        console.log(getUrlVar("id"));
        $.ajax({
            type: "get",
            url: "/article/details/" + getUrlVar("id"),  //得到需要更新文章的id
            success: function (data) {
                console.log(data);
                initCategoryId = data.articleCategoryId;
                $("#articleTitle").val(data.articleTitle);
                $("#choose").val(data.articleType);
                $("#order").val(data.articleOrder);
                $("#author").val(data.articleAuthor);
                $("#description").val(data.articleDesc);
                $("#txt").val(data.articleContent);
                $("#categoryName").val(data.categoryName);
            }
        });

        layui.use('layedit', function () {
            var layedit = layui.layedit;

            layedit.set({
                uploadImage: {
                    url: '/article/upload' //接口url
                    , type: 'post' //默认post
                    , size: 0
                }
            });

            var editIndex = layedit.build('txt', {
                height: 400
            });

            document.getElementById('btn1').onclick = function () {
                var articleTitle = document.getElementById("articleTitle").value;
                var articleOrder = document.getElementById("order").value;
                var articleType = chooseValue("choose");
                console.log(articleType);
                var articleAuthor = document.getElementById("author").value;
                var articleDesc = document.getElementById("description").value;
                var categoryId = document.getElementById("parentId").value;
                if (categoryId.length === 0) categoryId = initCategoryId;
                var articleContent = layedit.getContent(editIndex);     //得到layui编辑器里边的文章
                $.ajax({
                    url: "/article/update/" + getUrlVar("id"),
                    type: 'post',
                    dataType: 'json',
                    contentType: "application/json",
                    data: JSON.stringify({
                        "articleTitle": articleTitle,
                        "articleType": articleType,
                        "articleAuthor": articleAuthor,
                        "articleOrder": articleOrder,
                        "articleCategoryId": categoryId,
                        "articleDesc": articleDesc
                    }),
                    success: function (data) {
                        console.log(data);
                        if (data.code === 0) {
                            //关闭弹框
                            layer.msg("添加成功", {icon: 6});
                        } else {
                            layer.msg("添加失败", {icon: 5});
                        }
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    }
                });
            }
        });
    }
</script>
<script type="text/javascript">
    var index = $("#categoryName").on('click', function () {
        layer.open({
            id: 1,
            type: 2,
            skin: 'layui-layer-rim',
            closeBtn: 1,
            anim: 5,
            content: '/fragement/selectCategory.html',
            success: function (layero, index) {
                console.log(layero, index);
            }
        });
    });

    //  上传缩略图
    function uploadImg() {
        var options = {
            url: "/article/img",
            type: 'post',
            dataType: "json",
            success: function (data, status, xhr) {
                $("#image").attr("src", data.src);
            }
        };
        $("#img").ajaxSubmit(options);
    }
</script>